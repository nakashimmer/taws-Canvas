<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>5</title>
		<style>
			canvas{border:1px dotted gray;margin:10px auto;display:block;}
			/*① 背景*/
			#canvas1{
				background-image:url(bg1.png);
			}

		</style>
	</head>
	<body>
		<canvas id="canvas1" width="400" height="400"></canvas>
		<script>
			const CANVAS1 = document.getElementById("canvas1");
			const CTX1 = CANVAS1.getContext("2d");

			//②効果音初期化
			const AUDIO1 = new Audio();
			AUDIO1.src="audio1.mp3";

			//③初期化
			const TARGET1 = {
				x:200, y:100, w:50, h:50, dir:1,img:new Image()
			};
			TARGET1.img.src = "target1.png";
			const PLAYER1 = {x:200, y:300, w:50, h:50, img:new Image()};
			PLAYER1.img.src = "player1.png";
			const BALL1 = {x:-10, y:-10, w:5, h:5, img:new Image()};
			BALL1.img.src = "ball1.png";
			let point = 0;	

			//実行
			setInterval(loop, 50);

			function loop(){
				//①消去----------------------
				CTX1.clearRect(0, 0, canvas1.width, canvas1.height);

				//②描画----------------------
				imgDraw(TARGET1);
				imgDraw(PLAYER1);
				imgDraw(BALL1);

				//ポイント
				CTX1.fillStyle = "black";
				CTX1.font = "20px sans-serif";
				CTX1.fillText(point, 0, 400);

				//③計算---------------
				TARGET1.x += TARGET1.dir;
				BALL1.y -= 5;
	
				//壁衝突計算
				if( (TARGET1.x < TARGET1.w/2) || (CANVAS1.width - TARGET1.w/2 < TARGET1.x) ){
					TARGET1.dir *= -1;
				}
	
				//ポイントゲット
				if(
					(100 == BALL1.y) && (Math.abs(TARGET1.x - BALL1.x)<25)
				){
					point++; 
					AUDIO1.play();							//音を鳴らす
				}
			}

			//イベント処理
			CANVAS1.addEventListener(
				"mousedown",
				(e)=>{
					BALL1.x = PLAYER1.x;
					BALL1.y = PLAYER1.y; 
				}
			);

			CANVAS1.addEventListener(
				"mousemove",
				(e)=>{
					const RECT = e.target.getBoundingClientRect();
					PLAYER1.x = e.clientX-RECT.left;
				}
			);
			

			//④ 画像の定義
			function imgDraw(image){
				CTX1.drawImage(
					image.img, 
					image.x-image.w/2, 
					image.y-image.h/2
				);
			}
		</script>
	</body>
</html>